<?php

error_reporting(E_ALL);
ini_set('display_errors','On');
header('Content-Type: text/plain');

require_once('../base/TokenPay.php');

// BELOW WOULD BE POPULATED BY A FORM POST, OF COURSE
// Read how to do a Stripe token-based charge form: 
// https://stripe.com/docs/custom-form
$sToken = 'tok_5555lDvY6EUxb'; // uniqely generated by stripe.js - CHANGE ME

$sStripeSecretKey = 'YFLV5555jhCnkllCpHAViG315Xne7444'; // CHANGE ME

$sSKU = 'ACME-WIDGET-00001';

$sName = 'John Doe';
$sStreet1 = '100 Main Street';
$sStreet2 = 'Apt A';
$sCity = 'New York';
$sState = 'NY';
$sZip = '00000';
$sCountry = 'US';
$sPhone = '000-000-0000';
$sEmail = 'test@example.com';

$sSName = 'John Doe';
$sSStreet1 = '100 Main Street';
$sSStreet2 = 'Apt A';
$sSCity = 'New York';
$sSState = 'NY';
$sSZip = '00000';
$sSCountry = 'US';
$sSPhone = '000-000-0000';

// NOW PREPARE TO CHARGE
$sPrice = '100.50';
$sCurrency = 'USD';
$sDesc = "$sSKU : $sName : $sEmail : $sZip";

// NOW CHARGE
$o = TokenPay::createGateway('stripe');
$o->setAPIKey($sStripeSecretKey);
$o->setDebugMode(TRUE); // whether to send output of sending and receiving to the screen
$o->setTestMode(TRUE); // note, stripe ignores this b/c it is set by API key, instead
$o->setBilling(array(
	'billingName' => $sName,
	'billingAddress1' => $sStreet1,
	'billingAddress2' => $sStreet2,
	'billingCity' => $sCity,
	'billingState' => $sState,
	'billingPostcode' => $sZip,
	'billingCountry' => $sCountry,
	'billingPhone' => $sPhone,
	'email' => $sEmail
));
$o->setShipping(array(
	'shippingName' => $sSName,
	'shippingAddress1' => $sSStreet1,
	'shippingAddress2' => $sSStreet2,
	'shippingCity' => $sSCity,
	'shippingState' => $sSState,
	'shippingPostcode' => $sSZip,
	'shippingCountry' => $sSCountry,
	'shippingPhone' => $sSPhone
));
$o->setCharge(array(
	'amount' => $sPrice,
	'currency' => $sCurrency,
	'token' => $sToken,
	'description' => $sDesc
));
$oResponse = $o->chargeCard(); // HERE WE GO!
if ($oResponse->isSuccess) {
	$sTransID = $oResponse->TransID;
	die('SUCCESS: ' . $sTransID);
} else {
	$sError = $oResponse->FailMessage;
	$nError = $oResponse->FailCode;
	die('FAIL: ' . $sError . ' (' . $nError . ')');
}

